@model Akademinya.Models.Kurs
@using Akademinya.Models
@{
    ViewBag.Title = "KursDetay";

    AkademinyaEntities db = new AkademinyaEntities();
    Uye uye = null;
    var guid = Akademinya.Controllers.Genel.guidKontrol();
    var sepet = db.AlisverisSepeti.ToList().Where(x => x.Guid == guid);

    if (Request.Cookies["userGuid"] != null)
    {
        if (Request.Cookies["userGuid"].Value != "")
        {
            var userGuid = Request.Cookies["userGuid"].Value;
            uye = db.Uye.FirstOrDefault(x => x.CookieGuid == userGuid);
        }
    }

    var uyekurs = db.UyeKurs.ToList().Where(x => x.UyeID == 0);

    if (uye != null)
    {
        uyekurs = db.UyeKurs.ToList().Where(x => x.UyeID == uye.Id);
    }
}
@{//Yıldız rating için gerekli yerler
    var kayitliOgrenciSayisi = db.UyeKurs.Where(x => x.KursID == Model.Id).ToList().Count();
    var comments = (IEnumerable<Akademinya.Models.UyeKurs>)ViewBag.Comments;
    var ratingSum = ViewBag.RatingSum;
    var ratingCount = ViewBag.RatingCount;

    decimal rating = 0;
    if (ratingCount > 0)
    {
        rating = (ratingSum / ratingCount);
    }
    var totalRating = decimal.Parse(rating.ToString());
}

<div class="container" style="background-color:white">
    <div class="row">
        <!-- Post Content Column -->
        <div class="col-lg-8">
            <!-- Title -->
            <h1 class="mt-4">@Model.Ad</h1>
            <div class="starClass" style="display:inline-block">
                <div>
                    <span class="starFadeN" id="sRate1"></span><span class="starFadeN" id="sRate2"></span><span class="starFadeN" id="sRate3"></span><span class="starFadeN" id="sRate4"></span><span class="starFadeN" id="sRate5"></span>
                </div>
            </div>
            <h5 style="display: inline-block;vertical-align: middle;"> @kayitliOgrenciSayisi Kayıtlı öğrenci</h5>
            <!-- Author -->
            <p class="lead">
                by
                <a href="#">Furkan</a>
            </p>
            <hr>
            <!-- Date/Time -->
            <p>January 1, 2019 at 12:00 PM tarihinde güncellendi</p>
            <hr>
            <!-- Preview Image -->
            @*<h4>@Model.Resim</h4>*@
            <div style="text-align:center">
                @*<img class="img-fluid rounded" style="height:260px" src="@Model.Resim" alt="">*@
                <iframe style="width: 100%; height: 350px;" src="https://www.youtube.com/embed/E7Voso411Vs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>

            <hr>
            <div>
                <h4>Kurs içerikleri</h4>
                <div class="kd">
                    <button class="accordion">1. Bölüm</button>
                    <div class="panel">
                        @{
                            int a = 0;
                            foreach (var item in db.Video.ToList().Where(x => x.KursID == Model.Id ))
                            {
                                a++;
                                    <div style="border-bottom-style: solid; padding: 10px;margin:10px 0 10px 0;">
                                        @a.
                                        @item.VideoAdı
                                    </div>
                            }
                        }
                    </div>
                    <button class="accordion">2. Bölüm</button>
                    <div class="panel">
                        <p>5.video</p><hr />
                        <p>6.video</p><hr />
                        <p>7.video</p><hr />
                        <p>8.video</p><hr />
                    </div>
                </div>
            </div>
            <!-- Post Content -->
            <h4>Açıklama</h4>
            <p class="lead">@Model.Acikklama</p>

            <hr>
            <h4>Yorumlar</h4>
            <div style="margin-bottom:70px">

                @foreach (var c in comments)
                {
                    <div class="row">
                        <div class="col-md-2">
                            <a href="#" class="pull-left">
                                <img src="https://bootdey.com/img/Content/user_2.jpg" alt="" class="img-circle">
                            </a>
                        </div>
                        <div class="col-md-10" style="background-color:#eeeeee">
                            <div class="media-body">
                                <span class="text-muted pull-right">
                                    <small class="text-muted">@c.DegerlendirmeTarihi.ToShortDateString()</small>
                                </span>
                                <strong class="text-success">@c.Uye.Mail</strong>
                                <div class="starClass" style="display:inline-block;margin-left:20px">
                                    @for (var i = 1; i <= c.KursPuan; i++)
                                    {
                                        <span class="starGlowN"></span>
                                    }
                                    @for (var i = (c.KursPuan + 1); i <= 5; i++)
                                    {
                                        <span class="starFadeN"></span>
                                    }
                                </div>
                                <p>
                                    @c.KursYorum
                                </p>
                            </div>

                        </div>

                    </div>
                    <hr />
                }
            </div>
        </div>
        <!-- Sidebar Widgets Column -->
        <div class="col-md-4">

            <!-- Categories Widget -->
            <div class="card my-4">
                <h5 class="card-header">İçerik</h5>
                <div class="card-body">
                    @Model.Icerik
                </div>
            </div>
            <!-- Side Widget -->
            <div class="card my-4">

                @if (Model.Ücretsiz == true)
                {
                    <h5 class="card-header"> Ücretsiz</h5>
                }
                else
                {
                    <h5 class="card-header">@Model.Fiyat ₺</h5>
                }

                <div class="card-body">
                    @if (uyekurs.Any(x => x.KursID == Model.Id && x.UyeID == uye.Id))
                    {
                        <button type="button" onclick="window.location.href='../../KursIzlemeSayfasi/@Model.Id'">Kursa git</button>
                    }
                    else
                    {
                        if (sepet.Any(x => x.KursID == Model.Id))
                        {
                            <button type="button" onclick="return SepeteGit(@Model.Id)">Sepete Git</button>
                        }
                        else
                        {
                            if (Model.Ücretsiz == true)
                            {
                                if (uye == null)
                                {
                                    <button type="button" onclick="return islemler.GirisYap()">Hemen Kaydol</button>
                                }
                                else
                                {
                                    <button type="button" onclick="window.location.href='../../UcretsizKursKayit/@Model.Id'">Hemen Kaydol</button>
                                }

                            }
                            else
                            {
                                <button type="button" onclick="return SepeteEkle(@Model.Id)">Sepete Ekle</button>
                            }

                        }
                    }

                </div>
            </div>
        </div>
    </div>
    <!-- /.row -->
</div>

<script>

    //accordion baş
    var acc = document.getElementsByClassName("accordion");
    var i;

    for (i = 0; i < acc.length; i++) {
        acc[i].addEventListener("click", function () {
            this.classList.toggle("active");
            var panel = this.nextElementSibling;
            if (panel.style.maxHeight) {
                panel.style.maxHeight = null;
            } else {
                panel.style.maxHeight = panel.scrollHeight + "px";
            }
        });
    }
    //accordion son

    function SepeteEkle(Id) {
        //window.location = '/SepeteEkle/' + Id;
        bootbox.alert({
            message: "Sepete eklendi",
            callback: function () {
                    window.location = '/SepeteEkle/' + Id;
            }
        })
    }
    function SepeteGit(Id) {
        window.location = '/AlisverisSepeti/';
    }
    //yıldız baş
    function SCRate() {

        for (var i = 1; i <= @totalRating; i++) {
            $("#sRate" + i).attr('class', 'starGlowN');
        }
    }
    $(function () {
        SCRate();
    });
    //yıldız son

</script>